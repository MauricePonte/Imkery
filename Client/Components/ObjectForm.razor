@using Imkery.Client.Components.ObjectFormComponent
@using Imkery.Entities
@using MudBlazor
@typeparam TItem where TItem : class, IEntity<TItem>, new();
@inherits ObjectFormBase<TItem>;


<MudForm @ref="form" @bind-IsValid="@Success"
         @onsubmit="SubmitItem">

    <MudPaper Class="pl-16 ma-2 pr-16 pt-4 pb-4 d-flex justify-end" Elevation="3">
        <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Save" Color="Color.Info" Size="Size.Small">Save</MudButton>
    </MudPaper>

    <MudPaper Class="pa-16 ma-2" Elevation="3">
        @if (EditingItem != null)
        {

            @if (Errors != null)
            {
                @foreach (string error in Errors)
                {
                    <MudText Color="@Color.Error">@error</MudText>
                }
            }
            @foreach (var field in ObjectFields)
            {
                field.Item = EditingItem;
                if (field.DeviatingView != null)
                {
                    @field.DeviatingView(EditingItem)
                    ;
                }
                else if (field is ObjectField<TItem, string> stringField)
                {
                    <MudTextField T="string" Label="@field.Label" @bind-Text="@stringField.Value" />
                }
                else if (field is ObjectField<TItem, int> intField)
                {
                    <MudNumericField T="int" Label="@field.Label" @bind-Value="@intField.Value" />
                }
                <!--Todo add other possible field values-->
            }
        }
    </MudPaper>

    <MudPaper Class="pl-16 ma-2 pr-16 pt-4 pb-4 d-flex justify-end" Elevation="3">
        <MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Save" Color="Color.Info" ButtonType="ButtonType.Submit" Size="Size.Small">Save</MudButton>
    </MudPaper>
</MudForm>
